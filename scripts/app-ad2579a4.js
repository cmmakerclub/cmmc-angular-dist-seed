"use strict";angular.module("rfid",["ngAnimate","ngCookies","ngTouch","ngSanitize","ngRoute","ui.bootstrap","btford.socket-io"]).factory("socket",["socketFactory",function(t){var n=document.location.hostname+":4000",e=io.connect(n),r=t({ioSocket:e});return r}]).config(["$routeProvider",function(t){t.when("/",{templateUrl:"app/rfid/partials/rfid.html",controller:"RfidCtrl"}).when("/about",{templateUrl:"app/about/partials/about.html",controller:"AboutCtrl"}).when("/user",{templateUrl:"app/about/partials/about.html",controller:"UserCtrl"}).when("/rfid",{templateUrl:"app/rfid/partials/rfid.html",controller:"RfidCtrl"}).otherwise({redirectTo:"/"})}]),function(){angular.module("rfid").controller("userCtrl",["$scope",function(t){return t.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],t}])}.call(this),angular.module("rfid").controller("RfidCtrl",["$scope","socket","$timeout",function(t,n){var e,r="",i=function(){console.log("UPGRADE"),t.msg="SHOULD BE UPGRADE"};"webkitSpeechRecognition"in window?(t.recognition=new webkitSpeechRecognition,t.recognition.lang="th-TH",t.recognition.continuous=!0,t.recognition.interimResults=!0,t.recognition.onstart=function(){t.recognizing=!0,console.log("ON START",arguments)},t.recognition.onend=function(){console.log("ON END",arguments),t.recognizing=!1,t.ignore_onend},t.recognition.onerror=function(){console.log("ERROR"),"no-speech"==event.error&&(t.ignore_onend=!0),"audio-capture"==event.error&&(t.ignore_onend=!0),"not-allowed"==event.error&&(t.ignore_onend=!0)},t.recognition.onresult=function(){for(var n="",e=event.resultIndex;e<event.results.length;++e)event.results[e].isFinal?r+=event.results[e][0].transcript:n+=event.results[e][0].transcript,t.final_text_1=n,t.$apply();r=r,t.final_text=r,t.$apply(),t.recognizing=!1}):i(),t.start_regcognize=function(){return t.recognizing?(console.log("STOP"),void t.recognition.stop()):(r="",t.recognition.start(),t.ignore_onend=!1,void(e=event.timeStamp))};var o=new SpeechSynthesisUtterance,a=function(t,n,e){o.text=t,o.pitch=1,o.lang="th-TH",o.onstart=function(t){e&&e(t)},o.onend=function(t){n&&n(t)},speechSynthesis.speaking&&console.log("SKIP")};t.$on("$viewContentLoaded",function(){console.log("LOADED")}),n.on("rfid-read",function(n){t.cardId=n.cardId;var e=function(){t.start_regcognize()},r=function(){a("มีอะไรให้ช่วยบ้าง? ",e)};a("สวัสดี "+n.name.en,r)})}]),angular.module("rfid").controller("AboutCtrl",["$scope",function(t){t.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("rfid").controller("NavbarCtrl",["$scope",function(t){t.date=new Date}]),function(){var t,n,e,r,i,o;n="0.7.0",navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,function(){var t,n,e,r,i,o,a,s;for(i=window,s=["ms","moz","webkit","o"],o=0,a=s.length;a>o&&(r=s[o],!i.requestAnimationFrame);o++)i.requestAnimationFrame=i[""+r+"RequestAnimationFrame"],i.cancelAnimationFrame=i[""+r+"CancelAnimationFrame"]||i[""+r+"CancelRequestAnimationFrame"];if(i.requestAnimationFrame){if(i.cancelAnimationFrame)return;return t=i.requestAnimationFrame,n={},i.requestAnimationFrame=function(e){var r;return r=t(function(t){return r in n?delete n[r]:e(t)})},i.cancelAnimationFrame=function(t){return n[t]=!0}}return e=0,i.requestAnimationFrame=function(t){var n;return e=Math.max(e+16,n=+new Date),i.setTimeout(function(){return t(+new Date)},e-n)},i.cancelAnimationFrame=function(t){return clearTimeout(t)}}(),i=("undefined"!=typeof localStorage&&null!==localStorage?localStorage.getItem:void 0)&&localStorage.getItem("wit_debug")?function(){return console.log.apply(console,arguments)}:function(){},r=function(t,n){return this.name="WitError",this.message=t||"",this.infos=n,this},r.prototype=Error.prototype,e="wss://api.wit.ai/speech_ws",t=function(t){var n,e;return this.conn=null,this.ctx=new AudioContext,this.state="disconnected",this.rec=!1,this.handleError=function(t){var n,e;return _.isFunction(e=this.onerror)?(n=_.isString(t)?t:_.isString(t.message)?t.message:"Something went wrong!",e.call(window,n,t)):void 0},this.handleResult=function(t){var n,e,r;return _.isFunction(e=this.onresult)?(r=t.outcome.intent,n=t.outcome.entities,e.call(window,r,n,t)):void 0},t&&(this.elem=t,t.innerHTML="<div class='mic mic-box icon-wit-mic'>\n</div>\n<svg class='mic-svg mic-box'>\n</svg>",t.className+=" wit-microphone",t.addEventListener("click",function(t){return function(){return t.fsm("toggle_record")}}(this)),e=this.elem.children[1],n="http://www.w3.org/2000/svg",this.path=document.createElementNS(n,"path"),this.path.setAttribute("stroke","#eee"),this.path.setAttribute("stroke-width","5"),this.path.setAttribute("fill","none"),e.appendChild(this.path)),this.rmactive=function(){return this.elem?this.elem.classList.remove("active"):void 0},this.mkactive=function(){return this.elem?this.elem.classList.add("active"):void 0},this.mkthinking=function(){var t,n,r,i,o,a,s,c,u,l,d,h,g;return this.thinking=!0,this.elem?(c=getComputedStyle(e),this.elem.classList.add("thinking"),d=parseInt(c.width,10),o=parseInt(c.height,10),n="border-box"===c.boxSizing?parseInt(c.borderTopWidth,10):0,a=d/2-n-5,t=1e3,r=d/2-n,i=o/2-n-a,h=0,u=1,s=(null!=(g=window.performance)?g.now():void 0)||new Date,l=function(e){return function(c){var g,m,p,f;return m=(c-s)%t/t*2*Math.PI-Math.PI/2,p=Math.cos(m)*a+d/2-n,f=Math.sin(m)*a+o/2-n,g=+(1.5*Math.PI>m&&m>Math.PI/2),e.path.setAttribute("d","M"+r+","+i+"A"+a+","+a+","+h+","+g+","+u+","+p+","+f),e.thinking?requestAnimationFrame(l):(e.elem.classList.remove("thinking"),e.path.setAttribute("d","M0,0"))}}(this),requestAnimationFrame(l)):void 0},this.rmthinking=function(){return this.thinking=!1},this},o={disconnected:{connect:function(t){var n,r;return t||this.handleError("No token provided"),n=new WebSocket(e),n.onopen=function(){return function(e){var r;return i("connection opened",e),r={token:t,bps:16,encoding:"signed-integer"},n.send(JSON.stringify(["auth",r]))}}(this),n.onclose=function(t){return function(){return t.fsm("socket_closed")}}(this),n.onmessage=function(t){return function(n){var e,r,i;return i=JSON.parse(n.data),r=i[0],e=i[1],e?t.fsm.call(t,r,e):t.fsm.call(t,r)}}(this),this.conn=n,r=function(t){return function(n){var e,r,o;return e=t.ctx,o=e.createMediaStreamSource(n),r=(e.createScriptProcessor||e.createJavascriptNode).call(e,4096,1,1),r.onaudioprocess=function(n){var e,r,o,a,s,c,u,l;if(t.rec){for(e=n.inputBuffer,r=e.getChannelData(0),s=r.length,a=new Int16Array(s),o=l=0;s>=0?s>=l:l>=s;o=s>=0?++l:--l)c=r[o],u=0>c?32768*c:32767*c,a[o]=u;return i("[audiobuffer] rate="+e.sampleRate+", samples="+s+", bytes="+a.byteLength),t.conn.send(a)}},o.connect(r),r.connect(e.destination),t.stream=n,t.proc=r,t.src=o,t.fsm("got_stream")}}(this),navigator.getUserMedia({audio:!0},r,this.handleError),"connecting"}},connecting:{"auth-ok":function(){return"waiting_for_stream"},got_stream:function(){return"waiting_for_auth"},error:function(t){return this.handleError(t),"connecting"},socket_closed:function(){return"disconnected"}},waiting_for_auth:{"auth-ok":function(){return"ready"}},waiting_for_stream:{got_stream:function(){return"ready"}},ready:{socket_closed:function(){return"disconnected"},timeout:function(){return"ready"},start:function(){return this.fsm("toggle_record")},toggle_record:function(){return this.conn.send(JSON.stringify(["start",this.context||{}])),this.rec=!0,this.ctx||console.error("No context"),this.stream||console.error("No stream"),this.src||console.error("No source"),this.proc||console.error("No processor"),"audiostart"}},audiostart:{error:function(t){return this.rec=!1,this.handleError(new r("Error during recording",{code:"RECORD",data:t})),"ready"},socket_closed:function(){return this.rec=!1,"disconnected"},stop:function(){return this.fsm("toggle_record")},toggle_record:function(){return this.rec=!1,this.conn.send(JSON.stringify(["stop"])),this.timer=setTimeout(function(t){return function(){return t.fsm("timeout")}}(this),6e4),"audioend"}},audioend:{socket_closed:function(){return this.timer&&clearTimeout(this.timer),"disconnected"},timeout:function(){return this.handleError(new r("Wit timed out",{code:"TIMEOUT"})),"ready"},error:function(t){return this.timer&&clearTimeout(this.timer),this.handleError(new r("Wit did not recognize intent",{code:"RESULT",data:t})),"ready"},result:function(t){return this.timer&&clearTimeout(this.timer),this.handleResult(t),"ready"}}},t.prototype.fsm=function(t){var n,e,r,a;if(e=null!=(a=o[this.state])?a[t]:void 0,n=Array.prototype.slice.call(arguments,1),_.isFunction(e))switch(r=e.apply(this,n),i("fsm: "+this.state+" + "+t+" -> "+r,n),this.state=r,("audiostart"===r||"audioend"===r||"ready"===r||"connecting"===r||"disconnected"===r)&&_.isFunction(e=this["on"+r])&&e.call(window),r){case"disconnected":this.rmthinking(),this.rmactive();break;case"ready":this.rmthinking(),this.rmactive();break;case"audiostart":this.mkactive();break;case"audioend":this.mkthinking(),this.rmactive()}else i("fsm error: "+this.state+" + "+t,n);return r},t.prototype.connect=function(t){return this.fsm("connect",t)},t.prototype.start=function(){return this.fsm("start")},t.prototype.stop=function(){return this.fsm("stop")},t.prototype.setContext=function(t){var n,e;this.context||(this.context={});for(n in t)e=t[n],this.context[n]=t[n];return i("context: ",this.context),null},window._||(window._={}),_.isFunction||(_.isFunction=function(t){return"function"==typeof t}),_.isString||(_.isString=function(t){return"[object String]"===toString.call(t)}),window.Wit||(window.Wit={}),Wit.Microphone=t}.call(this),angular.module("rfid").controller("MainCtrl",["$scope",function(t){t.awesomeThings=[{title:"AngularJS",url:"https://angularjs.org/",description:"HTML enhanced for web apps!",logo:"angular.png"},{title:"BrowserSync",url:"http://browsersync.io/",description:"Time-saving synchronised browser testing.",logo:"browsersync.png"},{title:"GulpJS",url:"http://gulpjs.com/",description:"The streaming build system.",logo:"gulp.png"},{title:"Jasmine",url:"http://jasmine.github.io/",description:"Behavior-Driven JavaScript.",logo:"jasmine.png"},{title:"Karma",url:"http://karma-runner.github.io/",description:"Spectacular Test Runner for JavaScript.",logo:"karma.png"},{title:"Protractor",url:"https://github.com/angular/protractor",description:"End to end test framework for AngularJS applications built on top of WebDriverJS.",logo:"protractor.png"},{title:"jQuery",url:"http://jquery.com/",description:"jQuery is a fast, small, and feature-rich JavaScript library.",logo:"jquery.jpg"},{title:"Bootstrap",url:"http://getbootstrap.com/",description:"Bootstrap is the most popular HTML, CSS, and JS framework for developing responsive, mobile first projects on the web.",logo:"bootstrap.png"},{title:"Angular UI Bootstrap",url:"http://angular-ui.github.io/bootstrap/",description:"Bootstrap components written in pure AngularJS by the AngularUI Team.",logo:"ui-bootstrap.png"},{title:"Sass (Node)",url:"https://github.com/sass/node-sass",description:"Node.js binding to libsass, the C version of the popular stylesheet preprocessor, Sass.",logo:"node-sass.png"}],angular.forEach(t.awesomeThings,function(t){t.rank=Math.random()})}]),angular.module("rfid").run(["$templateCache",function(t){t.put("app/main/main.html",'<div class="container"><div ng-include="\'components/navbar/navbar.html\'"></div><div class="jumbotron text-center"><h1>\'Allo, \'Allo!</h1><p class="lead"><img src="assets/images/yeoman.png" alt="I\'m Yeoman"><br>Always a pleasure scaffolding your apps.</p><p><a class="btn btn-lg btn-success" ng-href="#">Splendid!</a></p></div><div class="row"><div class="col-sm-6 col-md-4" ng-repeat="awesomeThing in awesomeThings | orderBy:\'rank\'"><div class="thumbnail"><img class="pull-right" ng-src="assets/images/{{awesomeThing.logo}}" alt="{{awesomeThing.title}}"><div class="caption"><h3>{{awesomeThing.title}}</h3><p>{{awesomeThing.description}}</p><p><a ng-href="{{awesomeThing.url}}">{{awesomeThing.url}}</a></p></div></div></div></div><hr></div>'),t.put("components/navbar/navbar.html",'<nav class="navbar navbar-static-top navbar-inverse" ng-controller="NavbarCtrl"><div class="container-fluid"><div class="navbar-header"><a class="navbar-brand"><span class="glyphicon"></span> RFID Reader</a></div><div class="collapse navbar-collapse" id="bs-example-navbar-collapse-6"><ul class="nav navbar-nav"></ul></div></div></nav>'),t.put("app/about/partials/about.html",'<div class="container"><div ng-include="\'components/navbar/navbar.html\'"></div></div>'),t.put("app/rfid/partials/rfid.html",'<div class="container"><div ng-include="\'components/navbar/navbar.html\'"></div><h1 ng-hide="cardId">Waiting...<h1><span ng-show="cardId">CARD:</span> {{ cardId }} {{ status }}</h1></h1></div>')}]);